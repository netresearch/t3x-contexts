#!/bin/bash

## Description: Render extension documentation using TYPO3 render-guides
## Usage: render-docs
## Example: ddev render-docs

set -e

PROJECT_ROOT="${DDEV_APPROOT}"
DOCS_SOURCE="${PROJECT_ROOT}/Documentation"
DOCS_OUTPUT="${PROJECT_ROOT}/Documentation-GENERATED-temp"

echo "Rendering documentation..."
echo "Source: ${DOCS_SOURCE}"
echo "Output: ${DOCS_OUTPUT}"

# Clean output directory (use Docker to remove root-owned files from previous renders)
mkdir -p "${DOCS_OUTPUT}"
docker run --rm -v "${DOCS_OUTPUT}:/cleanup" alpine:3 sh -c "rm -rf /cleanup/*"

# Render using TYPO3 render-guides Docker image with current user
docker run --rm \
    --user "$(id -u):$(id -g)" \
    -v "${DOCS_SOURCE}:/project/docs" \
    -v "${DOCS_OUTPUT}:/project/Documentation-GENERATED-temp" \
    ghcr.io/typo3-documentation/render-guides:latest \
    --progress

echo ""
echo "Documentation rendered successfully!"
echo "View at: https://docs.contexts.ddev.site/"
